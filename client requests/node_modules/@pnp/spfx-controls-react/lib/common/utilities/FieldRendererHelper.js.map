{"version":3,"sources":["common/utilities/FieldRendererHelper.ts"],"names":[],"mappings":"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","file":"common/utilities/FieldRendererHelper.js","sourcesContent":["import * as React from 'react';\nimport { ISPFieldLookupValue, ITerm, IPrincipal } from '../SPEntities';\nimport { FieldTextRenderer } from '../../controls/fields/fieldTextRenderer/FieldTextRenderer';\nimport { FieldDateRenderer } from '../../controls/fields/fieldDateRenderer/FieldDateRenderer';\nimport { ListItemAccessor } from '@microsoft/sp-listview-extensibility';\nimport { SPHelper } from './SPHelper';\nimport { FieldTitleRenderer } from '../../controls/fields/fieldTitleRenderer/FieldTitleRenderer';\nimport { SPField } from '@microsoft/sp-page-context';\nimport { IContext } from '../Interfaces';\nimport { GeneralHelper } from './GeneralHelper';\nimport { FieldLookupRenderer, IFieldLookupClickEventArgs } from '../../controls/fields/fieldLookupRenderer/FieldLookupRenderer';\nimport { FieldUrlRenderer } from '../../controls/fields/fieldUrlRenderer/FieldUrlRenderer';\nimport { FieldTaxonomyRenderer } from '../../controls/fields/fieldTaxonomyRenderer/FieldTaxonomyRenderer';\nimport { IFieldRendererProps } from '../../controls/fields/fieldCommon/IFieldRendererProps';\nimport { FieldUserRenderer } from '../../controls/fields/fieldUserRenderer/FieldUserRenderer';\nimport { FieldFileTypeRenderer } from '../../controls/fields/fieldFileTypeRenderer/FieldFileTypeRenderer';\nimport { FieldAttachmentsRenderer } from '../../controls/fields/fieldAttachmentsRenderer/FieldAttachmentsRenderer';\nimport { FieldNameRenderer } from '../../controls/fields/fieldNameRenderer/FieldNameRenderer';\n\n/**\n * Field Renderer Helper.\n * Helps to render fields similarly to OOTB SharePoint rendering\n */\nexport class FieldRendererHelper {\n    /**\n     * Returns JSX.Element with OOTB rendering and applied additional props\n     * @param fieldValue Value of the field\n     * @param props IFieldRendererProps (CSS classes and CSS styles)\n     * @param listItem Current list item\n     * @param context Customizer context\n     */\n    public static getFieldRenderer(fieldValue: any, props: IFieldRendererProps, listItem: ListItemAccessor, context: IContext): Promise<JSX.Element> {\n        return new Promise<JSX.Element>(resolve => {\n            const field: SPField = context.field;\n            const listId: string = context.pageContext.list.id.toString();\n            const fieldType: string = field.fieldType;\n            const fieldName: string = field.internalName; //SPHelper.getFieldNameById(field.id.toString());\n            let result: JSX.Element = null;\n            const fieldValueAsEncodedText: string = fieldValue ? GeneralHelper.encodeText(fieldValue.toString()) : '';\n\n            switch (fieldType) {\n                case 'Text':\n                case 'Choice':\n                case 'Boolean':\n                case 'MultiChoice':\n                case 'Computed':\n                    const fieldStoredName: string = SPHelper.getStoredFieldName(fieldName);\n                    if (fieldStoredName === 'Title') {\n                        resolve(React.createElement(FieldTitleRenderer, {\n                            text: fieldValueAsEncodedText,\n                            isLink: fieldName === 'LinkTitle' || fieldName === 'LinkTitleNoMenu',\n                            listId: listId,\n                            id: listItem.getValueByName('ID'),\n                            baseUrl: context.pageContext.web.absoluteUrl,\n                            ...props\n                        }));\n                    }\n                    else if (fieldStoredName === 'DocIcon') {\n                        const path: string = listItem.getValueByName('FileLeafRef');\n                        resolve(React.createElement(FieldFileTypeRenderer, {\n                            path: path,\n                            isFolder: SPHelper.getRowItemValueByName(listItem, 'FSObjType') === '1',\n                            ...props\n                        }));\n                    }\n                    else if (fieldStoredName === 'FileLeafRef') {\n                        resolve(React.createElement(FieldNameRenderer, {\n                            text: fieldValueAsEncodedText,\n                            isLink: true,\n                            filePath: SPHelper.getRowItemValueByName(listItem, 'FileRef'),\n                            isNew: SPHelper.getRowItemValueByName(listItem, 'Created_x0020_Date.ifnew') === '1',\n                            hasPreview: true,\n                            ...props\n                        }));\n                    }\n                    else if (fieldStoredName === 'URL') {\n                        resolve(React.createElement(FieldUrlRenderer, {\n                            isImageUrl: false,\n                            url: fieldValue.toString(),\n                            text: SPHelper.getRowItemValueByName(listItem, `URL.desc`) || fieldValueAsEncodedText,\n                            ...props\n                        }));\n                    }\n                    else {\n                        resolve(React.createElement(FieldTextRenderer, {\n                            text: fieldValueAsEncodedText,\n                            isSafeForInnerHTML: false,\n                            isTruncated: false,\n                            ...props\n                        }));\n                    }\n                    break;\n                case 'Integer':\n                case 'Counter':\n                case 'Number':\n                case 'Currency':\n                    resolve(React.createElement(FieldTextRenderer, {\n                        text: fieldValueAsEncodedText,\n                        isSafeForInnerHTML: true,\n                        isTruncated: false,\n                        ...props\n                    }));\n                    break;\n                case 'Note':\n                    SPHelper.getFieldProperty(field.id.toString(), \"RichText\", context, false).then(richText => {\n                        const isRichText: boolean = richText === true || richText === 'TRUE';\n                        let html: string = '';\n\n                        if (isRichText) {\n                            html = fieldValue.toString();\n                        }\n                        else {\n                            html = fieldValueAsEncodedText.replace(/\\n/g, \"<br>\");\n                        }\n                        // text is truncated if its length is more that 255 symbols or it has more than 4 lines\n                        let isTruncated: boolean = html.length > 255 || html.split(/\\r|\\r\\n|\\n|<br>/).length > 4;\n                        resolve(React.createElement(FieldTextRenderer, {\n                            text: html,\n                            isSafeForInnerHTML: true,\n                            isTruncated: isTruncated,\n                            ...props\n                        }));\n                    });\n                    break;\n                case 'DateTime':\n                    const friendlyDisplay: string = SPHelper.getRowItemValueByName(listItem, `${fieldName}.FriendlyDisplay`);\n                    resolve(React.createElement(FieldDateRenderer, {\n                        text: friendlyDisplay ? GeneralHelper.getRelativeDateTimeString(friendlyDisplay) : fieldValueAsEncodedText,\n                        ...props\n                    }));\n                    break;\n                case \"Lookup\":\n                case \"LookupMulti\":\n                    //\n                    // we're providing fieldId and context. In that case Lookup values will be rendered right away\n                    // without additional lag of waiting of response to get dispUrl.\n                    // The request for DispUrl will be sent only if user click on the value\n                    //\n                    const lookupValues = fieldValue as ISPFieldLookupValue[];\n                    resolve(React.createElement(FieldLookupRenderer, {\n                        lookups: lookupValues,\n                        fieldId: field.id.toString(),\n                        context: context,\n                        ...props\n                    }));\n                    break;\n                case 'URL':\n                    SPHelper.getFieldProperty(field.id.toString(), 'Format', context, true).then(format => {\n                        const isImage: boolean = format === 'Image';\n                        const text: string = SPHelper.getRowItemValueByName(listItem, `${fieldName}.desc`);\n                        resolve(React.createElement(FieldUrlRenderer, {\n                            isImageUrl: isImage,\n                            url: fieldValue.toString(),\n                            text: text,\n                            ...props\n                        }));\n                    });\n                    break;\n                case 'Taxonomy':\n                case 'TaxonomyFieldType':\n                case 'TaxonomyFieldTypeMulti':\n                    const terms: ITerm[] = Array.isArray(fieldValue) ? <ITerm[]>fieldValue : <ITerm[]>[fieldValue];\n                    resolve(React.createElement(FieldTaxonomyRenderer, {\n                        terms: terms,\n                        ...props\n                    }));\n                    break;\n                case 'User':\n                case 'UserMulti':\n                    resolve(React.createElement(FieldUserRenderer, {\n                        users: <IPrincipal[]>fieldValue,\n                        context: context,\n                        ...props\n                    }));\n                    break;\n                case 'Attachments':\n                    resolve(React.createElement(FieldAttachmentsRenderer, {\n                        count: parseInt(fieldValue),\n                        ...props\n                    }));\n                    break;\n                default:\n                    resolve(React.createElement(FieldTextRenderer, {\n                        text: fieldValueAsEncodedText,\n                        isSafeForInnerHTML: false,\n                        isTruncated: false,\n                        ...props\n                    }));\n                    break;\n            }\n        });\n    }\n}\n"],"sourceRoot":"../../../src"}