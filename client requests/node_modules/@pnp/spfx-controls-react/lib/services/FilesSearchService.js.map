{"version":3,"sources":["services/FilesSearchService.ts"],"names":[],"mappings":"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","file":"services/FilesSearchService.js","sourcesContent":["import { WebPartContext } from \"@microsoft/sp-webpart-base\";\nimport { SPHttpClient } from \"@microsoft/sp-http\";\nimport { ISearchResult, BingQuerySearchParams, IRecentFile } from \"./FilesSearchService.types\";\nimport { find } from \"office-ui-fabric-react/lib/Utilities\";\nimport { ExtensionContext } from \"@microsoft/sp-extension-base\";\nimport { GeneralHelper } from \"../common/utilities\";\n\n/**\n * Maximum file size when searching\n */\nconst MAXFILESIZE = 52428800;\n\n/**\n * Maximum number of search results\n */\nconst MAXRESULTS = 100;\n\nexport class FilesSearchService {\n  private context: ExtensionContext | WebPartContext;\n  private bingAPIKey: string;\n\n  constructor(context: ExtensionContext | WebPartContext, bingAPIKey: string) {\n    this.context = context;\n    this.bingAPIKey = bingAPIKey;\n  }\n\n  /**\n   * Checks if file exists\n   */\n  public checkFileExists = async (fileUrl: string): Promise<boolean> => {\n    try {\n      const fetchFileResult = await this.context.httpClient.fetch(fileUrl, SPHttpClient.configurations.v1, {\n        headers: new Headers(),\n        method: 'HEAD',\n        mode: 'cors'\n      });\n\n      if (!fetchFileResult || !fetchFileResult.ok) {\n        throw new Error(`Something went wrong when executing search query. Status='${fetchFileResult.status}'`);\n      }\n\n      return true;\n    } catch (err) {\n      console.error(`[BingFilesService.fetchFile]: Err='${err.message}'`);\n      return false;\n    }\n  }\n\n  /**\n   * Executes Recent files search.\n   */\n  public executeRecentSearch = async (accepts?: string[]) => {\n    try {\n      const webId = this.context.pageContext.web.id.toString();\n      const siteId = this.context.pageContext.site.id.toString();\n      const fileFilter = this._getFileFilter(accepts);\n\n      const queryTemplate: string = `((SiteID:${siteId} OR SiteID: {${siteId}}) AND (WebId: ${webId} OR WebId: {${webId}})) AND LastModifiedTime < {Today} AND -Title:OneNote_DeletedPages AND -Title:OneNote_RecycleBin${fileFilter}`;\n      const queryData = {\n        __metadata: { \"type\": \"Microsoft.Office.Server.Search.REST.SearchRequest\" },\n        QueryTemplate: queryTemplate,\n        RowLimit: 20,\n        SelectProperties: {\n          results: [\n            \"Title\",\n            \"Path\",\n            \"Filename\",\n            \"FileExtension\",\n            \"FileType\",\n            \"Created\",\n            \"Author\",\n            \"LastModifiedTime\",\n            \"EditorOwsUser\",\n            \"ModifiedBy\",\n            \"LinkingUrl\",\n            \"SiteTitle\",\n            \"ParentLink\",\n            \"DocumentPreviewMetadata\",\n            \"ListID\",\n            \"ListItemID\",\n            \"SPSiteURL\",\n            \"SiteID\",\n            \"WebId\",\n            \"UniqueID\",\n            \"SPWebUrl\",\n            \"DefaultEncodingURL\",\n            \"PictureThumbnailURL\",\n          ]\n        },\n        SortList: {\n          results: [\n            {\n              \"Property\": \"LastModifiedTime\",\n              \"Direction\": 1\n            }\n          ]\n        }\n      };\n      const searchApi = `${this.context.pageContext.web.absoluteUrl}/_api/search/postquery`;\n\n      const recentSearchDataResult = await this.context.spHttpClient.post(searchApi, SPHttpClient.configurations.v1, {\n        headers: {\n          'accept': 'application/json;odata=nometadata',\n          'content-type': 'application/json;odata=verbose',\n          \"odata-version\": \"\"\n        },\n        body: JSON.stringify({\n          request: queryData\n        })\n      });\n      if (!recentSearchDataResult || !recentSearchDataResult.ok) {\n        throw new Error(`Something went wrong when executing search query. Status='${recentSearchDataResult.status}'`);\n      }\n\n      const recentSearchData = await recentSearchDataResult.json();\n      if (!recentSearchData || !recentSearchData.PrimaryQueryResult.RelevantResults.Table.Rows) {\n        throw new Error(`Cannot read JSON result`);\n      }\n\n      const recentFilesResult: IRecentFile[] = recentSearchData.PrimaryQueryResult.RelevantResults.Table.Rows.map((row) => { return this.parseRecentSearchResult(row.Cells); });\n      return recentFilesResult;\n    } catch (err) {\n      console.error(`[BingFilesService.executeRecentSearch]: Err='${err.message}'`);\n      return null;\n    }\n  }\n\n  /**\n   * Executes bing search for a file.\n   */\n  public executeBingSearch = async (queryParams: BingQuerySearchParams): Promise<ISearchResult[]> => {\n    try {\n      const aspect: string = queryParams.aspect ? queryParams.aspect : 'All';\n      const size: string = queryParams.size ? queryParams.size : 'All';\n      const license: string = queryParams.license ? queryParams.license : 'Any';\n      const query: string = queryParams.query;\n\n      const maxResults = queryParams.maxResults ? queryParams.maxResults : MAXRESULTS;\n      const maxFileSize = queryParams.maxFileSize ? queryParams.maxFileSize : MAXFILESIZE;\n\n      // No query\n      if (query === undefined) {\n        return;\n      }\n\n      // Submit the request\n      const apiUrl: string = `https://www.bingapis.com/api/v7/images/search?appid=${this.bingAPIKey}&traffictype=Internal_monitor&q=${encodeURIComponent(query)}&count=${maxResults}&aspect=${aspect}&maxFileSize=${maxFileSize}&size=${size}&mkt=en-US&license=${license}`;\n      \n      const searchDataResponse: any = await this.context.httpClient.get(apiUrl, SPHttpClient.configurations.v1, {        \n        method: 'GET',\n        mode: 'cors'\n      });\n\n      if (!searchDataResponse || !searchDataResponse.ok) {\n        throw new Error(`Something went wrong when executing search query. Status='${searchDataResponse.statusMessage}'`);\n      }\n      const searchData = await searchDataResponse.json();\n      if (!searchData || !searchData.value) {\n        throw new Error(`Cannot read JSON result`);\n      }\n      const bingResults: IBingSearchResult[] = searchData.value;\n      const searchResults = bingResults.map(item => this.parseBingSearchResult(item));\n\n      return searchResults;\n    } catch (err) {\n      console.error(`[BingFilesService.executeSearch]: Err='${err.message}'`);\n      return null;\n    }\n  }\n\n  /**\n   * Downloads document content from SP location.\n   */\n  public downloadSPFileContent = async (absoluteFileUrl: string, fileName: string): Promise<File> => {\n    try {\n      const fileDownloadResult = await this.context.spHttpClient.get(absoluteFileUrl, SPHttpClient.configurations.v1);\n\n      if (!fileDownloadResult || !fileDownloadResult.ok) {\n        throw new Error(`Something went wrong when downloading the file. Status='${fileDownloadResult.status}'`);\n      }\n\n      // Return file created from blob\n      const blob: Blob = await fileDownloadResult.blob();\n      // Retrieve file from blob - method supports IE11\n      return GeneralHelper.getFileFromBlob(blob, fileName);\n    } catch (err) {\n      console.error(`[FileSearchService.fetchFileContent] Err='${err.message}'`);\n      return null;\n    }\n  }\n\n  /**\n   * Downloads document content from Remote location.\n   */\n  public downloadBingContent = async (absoluteFileUrl: string, fileName: string): Promise<File> => {\n    try {\n      const fileDownloadResult = await this.context.httpClient.get(absoluteFileUrl, SPHttpClient.configurations.v1, {\n        method: \"GET\",\n        mode: \"cors\"\n      });\n\n      if (!fileDownloadResult || !fileDownloadResult.ok) {\n        throw new Error(`Something went wrong when downloading the file. Status='${fileDownloadResult.status}'`);\n      }\n\n      // Return file created from blob\n      const blob: Blob = await fileDownloadResult.blob();\n      return GeneralHelper.getFileFromBlob(blob, fileName);\n    } catch (err) {\n      console.error(`[FileSearchService.fetchFileContent] Err='${err.message}'`);\n      return null;\n    }\n  }\n\n  /**\n   * Parses Recent Search results.\n   */\n  private parseRecentSearchResult = (cells: Array<any>) => {\n    const titleCell = find(cells, x => x.Key == \"Title\");\n    const keyCell = find(cells, x => x.Key == \"UniqueID\");\n    const fileUrlCell = find(cells, x => x.Key == \"DefaultEncodingURL\");\n    const editedByCell = find(cells, x => x.Key == \"ModifiedBy\");\n\n    const recentFile: IRecentFile = {\n      key: keyCell ? keyCell.Value : null,\n      name: titleCell ? titleCell.Value : null,\n      fileUrl: fileUrlCell ? fileUrlCell.Value : null,\n      editedBy: editedByCell ? editedByCell.Value : null\n    };\n    return recentFile;\n  }\n\n  /**\n   * Parses Bing search results.\n   */\n  private parseBingSearchResult = (bingResult: IBingSearchResult): ISearchResult => {\n    // Get dimensions\n    const width: number = bingResult!.thumbnail!.width ? bingResult!.thumbnail!.width : bingResult!.width;\n    const height: number = bingResult!.thumbnail!.height ? bingResult!.thumbnail!.height : bingResult!.height;\n\n    // Create a search result\n    const searchResult: ISearchResult = {\n      thumbnailUrl: bingResult.thumbnailUrl,\n      contentUrl: bingResult.contentUrl,\n      displayUrl: this.getDisplayUrl(bingResult.hostPageDisplayUrl),\n      key: bingResult.imageId,\n      width: width,\n      height: height,\n    };\n    return searchResult;\n  }\n\n  /**\n   * Builds a file filter using the accepted file extensions\n   */\n  private _getFileFilter(accepts?: string[]) {\n    let fileFilter: string = undefined;\n    if (accepts) {\n      fileFilter = \" AND (\";\n      accepts.forEach((fileType: string, index: number) => {\n        fileType = fileType.replace(\".\", \"\");\n        if (index > 0) {\n          fileFilter = fileFilter + \" OR \";\n        }\n        fileFilter = fileFilter + `FileExtension:${fileType} OR SecondaryFileExtension:${fileType}`;\n      });\n      fileFilter = fileFilter + \")\";\n    }\n    return fileFilter;\n  }\n\n  /**\n   * Removes protocol and retrieves only the domain, just like Bing search results does\n   * in the SharePoint file picker\n   * @param url The display url as provided by Bing\n   */\n  private getDisplayUrl = (url: string): string => {\n    // remove any protocols\n    if (url.indexOf('://') > -1) {\n      const urlParts: string[] = url.split('://');\n      url = urlParts.pop();\n    }\n\n    // Split the URL on the first slash\n    const splitUrl = url.split('/');\n    return splitUrl[0];\n  }\n}\n"],"sourceRoot":"../../src"}