/**
@license
 * @pnp/odata v1.0.1 - pnp - provides shared odata functionality and base classes
 * MIT (https://github.com/pnp/pnp/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: http://officedev.github.io/PnP-JS-Core
 * source: https://github.com/pnp/pnp
 * bugs: https://github.com/pnp/pnp/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@pnp/common"),require("tslib"),require("@pnp/logging")):"function"==typeof define&&define.amd?define(["exports","@pnp/common","tslib","@pnp/logging"],t):t((e.pnp=e.pnp||{},e.pnp.odata={}),e.pnp.common,e.tslib_1,e.pnp.logging)}(this,function(e,t,n,r){"use strict";var o=function(){function e(e){this.key=e,this.expiration=t.Util.dateAdd(new Date,"second",t.RuntimeConfig.defaultCachingTimeoutSeconds),this.storeName=t.RuntimeConfig.defaultCachingStore}return Object.defineProperty(e.prototype,"store",{get:function(){return"local"===this.storeName?e.storage.local:e.storage.session},enumerable:!0,configurable:!0}),e.storage=new t.PnPClientStorage,e}(),i=function(){function e(e,t){this._parser=e,this._cacheOptions=t}return e.prototype.parse=function(e){var t=this;return this._parser.parse(e).then(function(e){return null!==t._cacheOptions.store&&t._cacheOptions.store.put(t._cacheOptions.key,e,t._cacheOptions.expiration),e})},e}(),u=function(e){function t(t,n,o){var i=e.call(this,"Error making HttpClient request in queryable: ["+t+"] "+n)||this;return i.status=t,i.statusText=n,i.data=o,i.name="ProcessHttpClientResponseException",r.Logger.log({data:i.data,level:3,message:i.message}),i}return n.__extends(t,e),t}(Error),s=function(){function e(){}return e.prototype.parse=function(e){var t=this;return new Promise(function(n,r){t.handleError(e,r)&&e.text().then(function(e){return e.replace(/\s/gi,"").length>0?JSON.parse(e):{}}).then(function(e){return n(t.parseODataJSON(e))}).catch(function(e){return r(e)})})},e.prototype.handleError=function(e,t){return e.ok||e.json().then(function(n){var r={responseBody:n,responseHeaders:e.headers};t(new u(e.status,e.statusText,r))}).catch(function(n){r.Logger.log({data:n,level:2,message:"There was an error parsing the error response body. See data for details."});var o={responseBody:"[[body not available]]",responseHeaders:e.headers};t(new u(e.status,e.statusText,o))}),e.ok},e.prototype.parseODataJSON=function(e){var t=e;return e.hasOwnProperty("d")?t=e.d.hasOwnProperty("results")?e.d.results:e.d:e.hasOwnProperty("value")&&(t=e.value),t},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(s),c=function(){function e(){}return e.prototype.parse=function(e){return e.text()},e}(),l=function(){function e(){}return e.prototype.parse=function(e){return e.blob()},e}(),p=function(){function e(){}return e.prototype.parse=function(e){return e.json()},e}(),h=function(){function e(){}return e.prototype.parse=function(e){return t.Util.isFunc(e.arrayBuffer)?e.arrayBuffer():e.buffer()},e}();function f(e,t){return new Promise(function(n){e.result=t,e.hasResult=!0,n(e)})}function g(e){return e.pipeline.length>0?e.pipeline.shift()(e):Promise.resolve(e)}function d(e){return e.pipeline.length<1&&r.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Request pipeline contains no methods!",2),g(e).then(function(e){return t=e,r.Logger.log({data:t.result,level:0,message:"["+t.requestId+"] ("+(new Date).getTime()+") Returning result, see data property for value."}),Promise.resolve(t.result||null);var t}).catch(function(e){throw r.Logger.error(e),e})}function y(e){return void 0===e&&(e=!1),function(t,n,o){var i=o.value;o.value=function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];return!e&&o.length>0&&o[0].hasOwnProperty("hasResult")&&o[0].hasResult?(r.Logger.write("["+o[0].requestId+"] ("+(new Date).getTime()+") Skipping request pipeline method "+n+", existing result in pipeline.",0),Promise.resolve(o[0])):(r.Logger.write("["+o[0].requestId+"] ("+(new Date).getTime()+") Calling request pipeline method "+n+".",0),i.apply(t,o).then(function(e){return g(e)}))}}}var b=function(){function e(){}return e.logStart=function(e){return new Promise(function(t){r.Logger.log({data:1===r.Logger.activeLogLevel?{}:e,level:1,message:"["+e.requestId+"] ("+(new Date).getTime()+") Beginning "+e.verb+" request ("+e.requestAbsoluteUrl+")"}),t(e)})},e.caching=function(e){return new Promise(function(n){if("GET"===e.verb&&e.isCached){r.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Caching is enabled for request, checking cache...",1);var u=new o(e.requestAbsoluteUrl.toLowerCase());if(void 0!==e.cachingOptions&&(u=t.Util.extend(u,e.cachingOptions)),null!==u.store){var s=u.store.get(u.key);if(null!==s)return r.Logger.log({data:1===r.Logger.activeLogLevel?{}:s,level:1,message:"["+e.requestId+"] ("+(new Date).getTime()+") Value returned from cache."}),e.batchDependency(),e.parser.hasOwnProperty("hydrate")&&(s=e.parser.hydrate(s)),f(e,s).then(function(e){return n(e)})}r.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Value not found in cache.",1),e.parser=new i(e.parser,u)}return n(e)})},e.send=function(e){return new Promise(function(n,o){if(e.isBatched){var i=e.batch.add(e.requestAbsoluteUrl,e.verb,e.options,e.parser);e.batchDependency(),r.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Batching request in batch "+e.batch.batchId+".",1),n(f(e,i))}else{r.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Sending request.",1);var u=e.clientFactory(),s=t.Util.extend(e.options||{},{method:e.verb});u.fetch(e.requestAbsoluteUrl,s).then(function(t){return e.parser.parse(t)}).then(function(t){return f(e,t)}).then(function(e){return n(e)}).catch(function(e){return o(e)})}})},e.logEnd=function(e){return new Promise(function(t){e.isBatched?r.Logger.log({data:1===r.Logger.activeLogLevel?{}:e,level:1,message:"["+e.requestId+"] ("+(new Date).getTime()+") "+e.verb+" request will complete in batch "+e.batch.batchId+"."}):r.Logger.log({data:1===r.Logger.activeLogLevel?{}:e,level:1,message:"["+e.requestId+"] ("+(new Date).getTime()+") Completing "+e.verb+" request."}),t(e)})},n.__decorate([y(!0)],e,"logStart",null),n.__decorate([y()],e,"caching",null),n.__decorate([y()],e,"send",null),n.__decorate([y(!0)],e,"logEnd",null),e}();function m(){return[b.logStart,b.caching,b.send,b.logEnd].slice(0)}var v=function(e){function t(t){void 0===t&&(t="This query is already part of a batch.");var n=e.call(this,t)||this;return n.name="AlreadyInBatchException",r.Logger.error(n),n}return n.__extends(t,e),t}(Error),_=function(){function e(){this._batch=null,this._query=new t.Dictionary,this._options={},this._url="",this._parentUrl="",this._useCaching=!1,this._cachingOptions=null}return e.prototype.concat=function(e){return this._url+=e,this},Object.defineProperty(e.prototype,"query",{get:function(){return this._query},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return t.mergeOptions(this._options,e),this},e.prototype.usingCaching=function(e){return t.RuntimeConfig.globalCacheDisable||(this._useCaching=!0,void 0!==e&&(this._cachingOptions=e)),this},e.prototype.inBatch=function(e){if(null!==this.batch)throw new v;return this._batch=e,this},e.prototype.toUrl=function(){return this._url},e.prototype.get=function(e,t){return void 0===e&&(e=new a),void 0===t&&(t={}),this.toRequestContext("GET",t,e,m()).then(function(e){return d(e)})},e.prototype.postCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new a),this.toRequestContext("POST",e,t,m()).then(function(e){return d(e)})},e.prototype.patchCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new a),this.toRequestContext("PATCH",e,t,m()).then(function(e){return d(e)})},e.prototype.deleteCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new a),this.toRequestContext("DELETE",e,t,m()).then(function(e){return d(e)})},e.prototype.addBatchDependency=function(){return null!==this._batch?this._batch.addDependency():function(){return null}},Object.defineProperty(e.prototype,"hasBatch",{get:function(){return t.Util.objectDefinedNotNull(this._batch)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batch",{get:function(){return this.hasBatch?this._batch:null},enumerable:!0,configurable:!0}),e.prototype.append=function(e){this._url=t.Util.combinePaths(this._url,e)},Object.defineProperty(e.prototype,"parentUrl",{get:function(){return this._parentUrl},enumerable:!0,configurable:!0}),e}(),w=function(){function e(e){void 0===e&&(e=t.Util.getGUID()),this._batchId=e,this._requests=[],this._dependencies=[]}return Object.defineProperty(e.prototype,"batchId",{get:function(){return this._batchId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requests",{get:function(){return this._requests},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t,n,r){var o={method:t.toUpperCase(),options:n,parser:r,reject:null,resolve:null,url:e},i=new Promise(function(e,t){o.resolve=e,o.reject=t});return this._requests.push(o),i},e.prototype.addDependency=function(){var e=function(){},t=new Promise(function(t){e=t});return this._dependencies.push(t),e},e.prototype.execute=function(){var e=this;return Promise.all(this._dependencies).then(function(){return Promise.all(e._dependencies)}).then(function(){return e.executeImpl()})},e}();e.CachingOptions=o,e.CachingParserWrapper=i,e.ProcessHttpClientResponseException=u,e.ODataParserBase=s,e.ODataDefaultParser=a,e.TextParser=c,e.BlobParser=l,e.JSONParser=p,e.BufferParser=h,e.setResult=f,e.pipe=d,e.requestPipelineMethod=y,e.PipelineMethods=b,e.getDefaultPipeline=m,e.AlreadyInBatchException=v,e.ODataQueryable=_,e.ODataBatch=w,Object.defineProperty(e,"__esModule",{value:!0})});