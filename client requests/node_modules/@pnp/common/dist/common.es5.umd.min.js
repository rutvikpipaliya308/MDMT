/**
@license
 * @pnp/common v1.0.1 - pnp - provides shared functionality across all pnp libraries
 * MIT (https://github.com/pnp/pnp/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: http://officedev.github.io/PnP-JS-Core
 * source: https://github.com/pnp/pnp
 * bugs: https://github.com/pnp/pnp/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@pnp/logging"),require("tslib")):"function"==typeof define&&define.amd?define(["exports","@pnp/logging","tslib"],t):t((e.pnp=e.pnp||{},e.pnp.common={}),e.pnp.logging,e.tslib_1)}(this,function(e,t,n){"use strict";function r(e,t){return new Promise(function(n,r){try{var o=new FileReader;switch(o.onload=function(e){n(e.target.result)},t){case"string":o.readAsText(e);break;case"buffer":o.readAsArrayBuffer(e)}}catch(e){r(e)}})}var o=function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.keys=e,this.values=t}return e.prototype.get=function(e){var t=this.keys.indexOf(e);return t<0?null:this.values[t]},e.prototype.add=function(e,t){var n=this.keys.indexOf(e);n>-1?null===t?this.remove(e):this.values[n]=t:null!==t&&(this.keys.push(e),this.values.push(t))},e.prototype.merge=function(e){var t=this;if("getKeys"in e){var n=e;n.getKeys().map(function(e){t.add(e,n.get(e))})}else{var r=e;for(var o in r)r.hasOwnProperty(o)&&this.add(o,r[o])}},e.prototype.remove=function(e){var t=this.keys.indexOf(e);if(t<0)return null;var n=this.values[t];return this.keys.splice(t,1),this.values.splice(t,1),n},e.prototype.getKeys=function(){return this.keys},e.prototype.getValues=function(){return this.values},e.prototype.clear=function(){this.keys=[],this.values=[]},Object.defineProperty(e.prototype,"count",{get:function(){return this.keys.length},enumerable:!0,configurable:!0}),e}();var i=function(e){function r(n){var r=e.call(this,n)||this;return r.name="UrlException",t.Logger.log({data:{},level:3,message:"["+r.name+"]::"+r.message}),r}return n.__extends(r,e),r}(Error);var a=function(){function e(){this._v=new o,this._v.add("defaultCachingStore","session"),this._v.add("defaultCachingTimeoutSeconds",60),this._v.add("globalCacheDisable",!1),this._v.add("enableCacheExpiration",!1),this._v.add("cacheExpirationIntervalMilliseconds",750),this._v.add("spfxContext",null)}return e.prototype.extend=function(e){var t=this;Object.keys(e).forEach(function(n){t._v.add(n,e[n])})},e.prototype.get=function(e){return this._v.get(e)},Object.defineProperty(e.prototype,"defaultCachingStore",{get:function(){return this.get("defaultCachingStore")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultCachingTimeoutSeconds",{get:function(){return this.get("defaultCachingTimeoutSeconds")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalCacheDisable",{get:function(){return this.get("globalCacheDisable")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableCacheExpiration",{get:function(){return this.get("enableCacheExpiration")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheExpirationIntervalMilliseconds",{get:function(){return this.get("cacheExpirationIntervalMilliseconds")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spfxContext",{get:function(){return this.get("spfxContext")},enumerable:!0,configurable:!0}),e}(),s=new a;function u(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return function(){t.apply(e,n)}}function c(e,t,n){var r=new Date(e);switch(t.toLowerCase()){case"year":r.setFullYear(r.getFullYear()+n);break;case"quarter":r.setMonth(r.getMonth()+3*n);break;case"month":r.setMonth(r.getMonth()+n);break;case"week":r.setDate(r.getDate()+7*n);break;case"day":r.setDate(r.getDate()+n);break;case"hour":r.setTime(r.getTime()+36e5*n);break;case"minute":r.setTime(r.getTime()+6e4*n);break;case"second":r.setTime(r.getTime()+1e3*n);break;default:r=void 0}return r}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(e){return!m.stringIsNullOrEmpty(e)}).map(function(e){return e.replace(/^[\\|\/]/,"").replace(/[\\|\/]$/,"")}).join("/").replace(/\\/g,"/")}function f(e){for(var t=new Array(e),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t[r]=n.charAt(Math.floor(Math.random()*n.length));return t.join("")}function p(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}function h(e){return"function"==typeof e}function d(e){return void 0!==e&&null!==e}function g(e){return Array.isArray?Array.isArray(e):e&&"number"==typeof e.length&&e.constructor===Array}function y(e,t,n){if(void 0===n&&(n=!1),!m.objectDefinedNotNull(t))return e;var r=n?function(e,t){return!(t in e)}:function(){return!0};return Object.getOwnPropertyNames(t).filter(function(t){return r(e,t)}).reduce(function(e,n){return e[n]=t[n],e},e)}function v(e){return/^https?:\/\/|^\/\//i.test(e)}function b(e){return void 0===e||null===e||e.length<1}var m=function(){function e(){}return e.getCtxCallback=u,e.dateAdd=c,e.combinePaths=l,e.getRandomString=f,e.getGUID=p,e.isFunc=h,e.objectDefinedNotNull=d,e.isArray=g,e.extend=y,e.isUrlAbsolute=v,e.stringIsNullOrEmpty=b,e}();function x(e,t){void 0!==t&&null!==t&&new Request("",{headers:t}).headers.forEach(function(t,n){e.append(n,t)})}var _=function(){function e(){}return e.prototype.fetch=function(e,t){return global.fetch(e,t)},e}(),w=function(e){function t(t){var n=e.call(this)||this;return n._token=t,n}return n.__extends(t,e),t.prototype.fetch=function(t,n){void 0===n&&(n={});var r=new Headers;return x(r,n.headers),r.set("Authorization","Bearer "+this._token),n.headers=r,e.prototype.fetch.call(this,t,n)},t}(_),C=function(){function e(e,n){void 0===n&&(n=-1),this.store=e,this.defaultTimeoutMinutes=n,this.enabled=this.test(),s.enableCacheExpiration&&(t.Logger.write("Enabling cache expiration.",1),this.cacheExpirationHandler())}return e.prototype.get=function(e){if(!this.enabled)return null;var n=this.store.getItem(e);if(null==n)return null;var r=JSON.parse(n);return new Date(r.expiration)<=new Date?(t.Logger.write("Removing item with key '"+e+"' from cache due to expiration.",1),this.delete(e),null):r.value},e.prototype.put=function(e,t,n){this.enabled&&this.store.setItem(e,this.createPersistable(t,n))},e.prototype.delete=function(e){this.enabled&&this.store.removeItem(e)},e.prototype.getOrPut=function(e,t,n){var r=this;return this.enabled?new Promise(function(o){var i=r.get(e);null==i?t().then(function(t){r.put(e,t,n),o(t)}):o(i)}):t()},e.prototype.deleteExpired=function(){var e=this;return new Promise(function(t,n){e.enabled||t();try{for(var r=0;r<e.store.length;r++){var o=e.store.key(r);null!==o&&/["|']?pnp["|']? ?: ?1/i.test(e.store.getItem(o))&&e.get(o)}t()}catch(e){n(e)}})},e.prototype.test=function(){try{return this.store.setItem("test","test"),this.store.removeItem("test"),!0}catch(e){return!1}},e.prototype.createPersistable=function(e,t){if(void 0===t){var n=s.defaultCachingTimeoutSeconds;this.defaultTimeoutMinutes>0&&(n=60*this.defaultTimeoutMinutes),t=m.dateAdd(new Date,"second",n)}return JSON.stringify({pnp:1,expiration:t,value:e})},e.prototype.cacheExpirationHandler=function(){var e=this;t.Logger.write("Called cache expiration handler.",0),this.deleteExpired().then(function(t){setTimeout(m.getCtxCallback(e,e.cacheExpirationHandler),s.cacheExpirationIntervalMilliseconds)}).catch(function(e){t.Logger.log({data:e,level:3,message:"Error deleting expired cache entries, see data for details. Timeout not reset."})})},e}(),k=function(){function e(e){void 0===e&&(e=new o),this._store=e}return Object.defineProperty(e.prototype,"length",{get:function(){return this._store.count},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._store.clear()},e.prototype.getItem=function(e){return this._store.get(e)},e.prototype.key=function(e){return this._store.getKeys()[e]},e.prototype.removeItem=function(e){this._store.remove(e)},e.prototype.setItem=function(e,t){this._store.add(e,t)},e}(),O=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._local=e,this._session=t}return Object.defineProperty(e.prototype,"local",{get:function(){return null===this._local&&(this._local="undefined"!=typeof localStorage?new C(localStorage):new C(new k)),this._local},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"session",{get:function(){return null===this._session&&(this._session="undefined"!=typeof sessionStorage?new C(sessionStorage):new C(new k)),this._session},enumerable:!0,configurable:!0}),e}();e.readBlobAsText=function(e){return r(e,"string")},e.readBlobAsArrayBuffer=function(e){return r(e,"buffer")},e.Dictionary=o,e.deprecated=function(e,n){return function(r,o,i){var a=i.value;i.value=function(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return t.Logger.log({data:{descriptor:i,propertyKey:o,target:r},level:2,message:"("+e+") "+n}),a.apply(this,s)}}},e.beta=function(e){return void 0===e&&(e="This feature is flagged as beta and is subject to change."),function(n,r,o){var i=o.value;o.value=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];return t.Logger.log({data:{descriptor:o,propertyKey:r,target:n},level:2,message:e}),i.apply(this,a)}}},e.UrlException=i,e.setup=function(e){s.extend(e)},e.RuntimeConfigImpl=a,e.RuntimeConfig=s,e.mergeHeaders=x,e.mergeOptions=function(e,t){if(m.objectDefinedNotNull(t)){var n=m.extend(e.headers||{},t.headers);(e=m.extend(e,t)).headers=n}},e.FetchClient=_,e.BearerTokenFetchClient=w,e.PnPClientStorageWrapper=C,e.PnPClientStorage=O,e.getCtxCallback=u,e.dateAdd=c,e.combinePaths=l,e.getRandomString=f,e.getGUID=p,e.isFunc=h,e.objectDefinedNotNull=d,e.isArray=g,e.extend=y,e.isUrlAbsolute=v,e.stringIsNullOrEmpty=b,e.Util=m,Object.defineProperty(e,"__esModule",{value:!0})});