{"version":3,"file":"ApiExtractorRunner.js","sourceRoot":"","sources":["../../src/shared/ApiExtractorRunner.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;AAG3D,4DAIkC;AAClC,yDAAyD;AAEzD,mEAAgE;AAChE,2CAAwC;AAExC;;;;;GAKG;AACH,MAAa,kBAAmB,SAAQ,6CAAqB;IAK3D,YACE,eAAgC,EAChC,gBAAyC,EACzC,QAAgB,EAChB,gBAAmC;QAEnC,KAAK,CAAC,EAAE,EAAE,QAAQ,EAAE,gBAAgB,CAAC,CAAC;QAEtC,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;QACxC,IAAI,CAAC,iBAAiB,GAAG,gBAAgB,CAAC;IAC5C,CAAC;IAEM,MAAM;QACX,IAAI;YACF,MAAM,gBAAgB,qBACjB,IAAI,CAAC,iBAAiB,IACzB,eAAe,EAAE,CAAC,OAAsC,EAAE,EAAE;oBAC1D,QAAQ,OAAO,CAAC,QAAQ,EAAE;wBACxB;4BACE,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;4BACnD,MAAM;wBACR;4BACE,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;4BACrD,MAAM;wBACR;4BACE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;4BAC9C,MAAM;wBACR;4BACE,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;4BACrD,MAAM;wBACR;4BACE,OAAO;qBACV;oBACD,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;gBACzB,CAAC,EACD,wBAAwB,EAAE,qBAAS,CAAC,qBAAqB,GAC1D,CAAC;YAEF,4FAA4F;YAC5F,iDAAiD;YACjD,yBAAS,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,EAAE,gBAAgB,CAAC,CAAC;YAE1D,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;SAC1B;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;SAC1B;IACH,CAAC;;AAlDa,+BAAY,GAAwB,YAAY,CAAC;AADjE,gDAoDC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { ITerminalProvider } from '@microsoft/node-core-library';\r\nimport {\r\n  Extractor,\r\n  ExtractorConfig,\r\n  IExtractorInvokeOptions\r\n} from '@microsoft/api-extractor';\r\nimport * as ApiExtractor from '@microsoft/api-extractor';\r\n\r\nimport { RushStackCompilerBase } from './RushStackCompilerBase';\r\nimport { ToolPaths } from './ToolPaths';\r\n\r\n/**\r\n * The ApiExtractorTask uses the api-extractor tool to analyze a project for public APIs. api-extractor will detect\r\n * common problems and generate a report of the exported public API. The task uses the entry point of a project to\r\n * find the aliased exports of the project. An api-extractor.ts file is generated for the project in the temp folder.\r\n * @beta\r\n */\r\nexport class ApiExtractorRunner extends RushStackCompilerBase {\r\n  public static apiExtractor: typeof ApiExtractor = ApiExtractor;\r\n  private _extractorConfig: ExtractorConfig;\r\n  private _extractorOptions: IExtractorInvokeOptions;\r\n\r\n  constructor(\r\n    extractorConfig: ExtractorConfig,\r\n    extractorOptions: IExtractorInvokeOptions,\r\n    rootPath: string,\r\n    terminalProvider: ITerminalProvider\r\n  ) {\r\n    super({}, rootPath, terminalProvider);\r\n\r\n    this._extractorConfig = extractorConfig;\r\n    this._extractorOptions = extractorOptions;\r\n  }\r\n\r\n  public invoke(): Promise<void> {\r\n    try {\r\n      const extractorOptions: IExtractorInvokeOptions = {\r\n        ...this._extractorOptions,\r\n        messageCallback: (message: ApiExtractor.ExtractorMessage) => {\r\n          switch (message.logLevel) {\r\n            case ApiExtractor.ExtractorLogLevel.Error:\r\n              this._terminal.writeErrorLine.bind(this._terminal);\r\n              break;\r\n            case ApiExtractor.ExtractorLogLevel.Warning:\r\n              this._terminal.writeWarningLine.bind(this._terminal);\r\n              break;\r\n            case ApiExtractor.ExtractorLogLevel.Info:\r\n              this._terminal.writeLine.bind(this._terminal);\r\n              break;\r\n            case ApiExtractor.ExtractorLogLevel.Verbose:\r\n              this._terminal.writeVerboseLine.bind(this._terminal);\r\n              break;\r\n            default:\r\n              return;\r\n          }\r\n          message.handled = true;\r\n        },\r\n        typescriptCompilerFolder: ToolPaths.typescriptPackagePath\r\n      };\r\n\r\n      // NOTE: ExtractorResult.succeeded indicates whether errors or warnings occurred, however we\r\n      // already handle this above via our customLogger\r\n      Extractor.invoke(this._extractorConfig, extractorOptions);\r\n\r\n      return Promise.resolve();\r\n    } catch (e) {\r\n      return Promise.reject(e);\r\n    }\r\n  }\r\n}\r\n"]}