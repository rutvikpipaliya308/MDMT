(window["webpackJsonp_4df9bb86_ab0a_4aab_ab5f_48bf167048fb_1_9_1"] = window["webpackJsonp_4df9bb86_ab0a_4aab_ab5f_48bf167048fb_1_9_1"] || []).push([[0],{

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/Base64Url.js":
/*!*********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/Base64Url.js ***!
  \*********************************************************************************************************************************************************************************/
/*! exports provided: decode */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "decode", function() { return decode; });
// Copied from Oslo code and updated with base64url support
// General base64 util based on this repo https://github.com/mathiasbynens/base64
// If you want to modify/change this code, consider this package instead - https://www.npmjs.com/package/atob
// This is just used for browsers <= IE9, for normal browsers use btoa and atob
var TABLE = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
/**
 * `decode` is designed to be fully compatible with `atob` as described in the
 * HTML Standard. http://whatwg.org/html/webappapis.html#dom-windowbase64-atob
 */
function decode(input) {
    input = input.trim();
    var length = input.length;
    if (length % 4 === 0) {
        input = input.replace(/==?$/, "");
        length = input.length;
    }
    if (length % 4 === 1 || /[^\-_a-zA-Z0-9]/.test(input)) {
        error("Invalid character: the string to be decoded is not correctly encoded.");
    }
    var bitCounter = 0;
    var bitStorage = 0;
    var buffer;
    var output = "";
    var position = -1;
    while (++position < length) {
        buffer = TABLE.indexOf(input.charAt(position));
        // tslint:disable-next-line:no-bitwise
        bitStorage = bitCounter % 4 ? bitStorage * 64 + buffer : buffer;
        // Unless this is the first of a group of 4 characters…
        // tslint:disable-next-line:no-bitwise
        if (bitCounter++ % 4) {
            // …convert the first 8 bits to a single ASCII character.
            output += String.fromCharCode(
            // tslint:disable-next-line:no-bitwise
            0xff & (bitStorage >> ((-2 * bitCounter) & 6)));
        }
    }
    return output;
}
function error(message) {
    var error = new Error(message);
    error.name = "InvalidCharacterError";
    throw new Error(message);
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetch.js":
/*!*****************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetch.js ***!
  \*****************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return fetch; });
/* harmony import */ var _statusOk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./statusOk */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/statusOk.js");

function fetch(options) {
    return new Promise(function (resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.open(options.method, options.url, true);
        if (options.timeoutMs) {
            xhr.timeout = options.timeoutMs;
        }
        var headers = options.headers || {};
        Object.keys(headers).map(function (key) {
            xhr.setRequestHeader(key, headers[key]);
        });
        xhr.onload = function () {
            if (xhr.readyState === 4) {
                if (Object(_statusOk__WEBPACK_IMPORTED_MODULE_0__["default"])(xhr.status)) {
                    resolve(xhr);
                }
                else {
                    reject(xhr);
                }
            }
        };
        xhr.onerror = function () {
            reject(xhr);
        };
        xhr.ontimeout = function () {
            reject(xhr);
        };
        var body = options.body || null;
        xhr.send(body);
    });
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetchAcquireToken.js":
/*!*****************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetchAcquireToken.js ***!
  \*****************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fetch */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetch.js");
/* harmony import */ var _withCache__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./withCache */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withCache.js");
/* harmony import */ var _withMonitor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./withMonitor */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withMonitor.js");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};



/* harmony default export */ __webpack_exports__["default"] = (Object(_withMonitor__WEBPACK_IMPORTED_MODULE_2__["default"])({
    monitorName: "prefetchAcquireToken",
    additionalSuccessPropsExtractor: function (xhr) {
        var responseText = xhr && xhr.responseText && JSON.parse(xhr.responseText);
        return __assign({}, (responseText && {
            resource: responseText.resource,
            expires_on: responseText.expires_on
        }));
    }
}, Object(_withCache__WEBPACK_IMPORTED_MODULE_1__["default"])(function (_a) {
    var digest = _a.digest, portalUrl = _a.portalUrl, resourceUrl = _a.resourceUrl, useSTI = _a.useSTI;
    var body = {
        resource: resourceUrl
    };
    if (useSTI) {
        body["tokenType"] = "STI";
    }
    return Object(_fetch__WEBPACK_IMPORTED_MODULE_0__["default"])({
        url: portalUrl + "/_api/SP.OAuth.Token/Acquire",
        method: "POST",
        headers: {
            "Content-Type": "application/json; charset=utf-8",
            "Odata-Version": "4.0",
            Accept: "application/json;odata.metadata=minimal",
            "X-RequestDigest": digest
        },
        body: JSON.stringify(body),
        timeoutMs: 7000
    }).then(function (xhr) {
        return {
            xhr: xhr,
            tokenAttemptCount: -1,
            tokenFetchDuration: -1,
            cacheItemType: null
        };
    });
})({
    cacheId: "psst",
    cacheVersion: "0",
    cacheItemLifetime: 1000 * 60 * 5,
    cacheKeyExtractor: function (options) { return ({ resource: options.resourceUrl }); }
})));


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetchSharePointDigest.js":
/*!*********************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetchSharePointDigest.js ***!
  \*********************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fetch */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetch.js");
/* harmony import */ var _withCache__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./withCache */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withCache.js");
/* harmony import */ var _withMonitor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./withMonitor */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withMonitor.js");



/* harmony default export */ __webpack_exports__["default"] = (function (_a) {
    var endpoint = _a.endpoint, forceDigestRefresh = _a.forceDigestRefresh;
    return Object(_withMonitor__WEBPACK_IMPORTED_MODULE_2__["default"])({
        monitorName: "prefetchSharepointDigest"
    }, Object(_withCache__WEBPACK_IMPORTED_MODULE_1__["default"])(function (_a) {
        var endpoint = _a.endpoint;
        return Object(_fetch__WEBPACK_IMPORTED_MODULE_0__["default"])({
            url: endpoint + "/_api/contextinfo",
            method: "POST",
            headers: {
                Accept: "application/json;odata=verbose",
                "Content-Type": "application/json;odata=verbose"
            },
            timeoutMs: 5000
        }).then(function (xhr) {
            return {
                xhr: xhr,
                tokenAttemptCount: -1,
                tokenFetchDuration: -1
            };
        });
    })({
        cacheId: "pspd",
        cacheVersion: "0",
        // 30 min timeout value gotten from
        // sts/stsom/Administration/SPCanary.cs
        // Subtract 10 seconds to keep digest current
        cacheItemLifetime: 30 * 60 * 1000 - 10000,
        cacheKeyExtractor: function (options) { return ({
            url: options.endpoint + "/_api/contextinfo"
        }); },
        forceRefresh: forceDigestRefresh
    }))({ endpoint: endpoint, forceDigestRefresh: forceDigestRefresh });
});


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetchSharePointDigestv2.js":
/*!***********************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetchSharePointDigestv2.js ***!
  \***********************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fetch */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetch.js");
/* harmony import */ var _fetcher__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fetcher */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetcher.js");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


var name = "fetchSharepointDigest";
var hasOverrideDigestBeenUsed = false;
/* harmony default export */ __webpack_exports__["default"] = (Object(_fetcher__WEBPACK_IMPORTED_MODULE_1__["default"])(function fetchSharePointDigest(_a) {
    var endpoint = _a.endpoint, token = _a.token, overrideDigest = _a.overrideDigest;
    if (overrideDigest && !hasOverrideDigestBeenUsed) {
        hasOverrideDigestBeenUsed = true;
        return new Promise(function (resolve) {
            // tslint:disable-next-line:no-object-literal-type-assertion
            var digestResponse = {
                responseText: JSON.stringify({
                    d: { GetContextWebInformation: { FormDigestValue: overrideDigest } }
                })
            };
            resolve(digestResponse);
        });
    }
    else {
        return Object(_fetch__WEBPACK_IMPORTED_MODULE_0__["default"])({
            url: endpoint + "/_api/contextinfo",
            method: "POST",
            headers: __assign({ Accept: "application/json;odata=verbose", "Content-Type": "application/json;odata=verbose" }, (token ? { Authorization: "Bearer " + token } : {})),
            timeoutMs: 5000
        });
    }
}, {
    monitorName: name,
    cacheId: name,
    cacheVersion: "0",
    // 30 min timeout value gotten from
    // sts/stsom/Administration/SPCanary.cs
    // Subtract 10 seconds to keep digest current
    cacheItemLifetime: 30 * 60 * 1000 - 10000,
    cacheKeyExtractor: function (options) { return ({
        url: options.endpoint
    }); }
}));


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetcher.js":
/*!*******************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/fetcher.js ***!
  \*******************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return fetcher; });
/* harmony import */ var _withCache__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./withCache */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withCache.js");
/* harmony import */ var _withMonitor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./withMonitor */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withMonitor.js");
/* harmony import */ var _withToken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./withToken */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withToken.js");



function fetcher(fetch, options) {
    return Object(_withMonitor__WEBPACK_IMPORTED_MODULE_1__["default"])(options, Object(_withCache__WEBPACK_IMPORTED_MODULE_0__["default"])(Object(_withToken__WEBPACK_IMPORTED_MODULE_2__["default"])(fetch))(options));
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/headerUtils.js":
/*!***********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/headerUtils.js ***!
  \***********************************************************************************************************************************************************************************/
/*! exports provided: spRequestDurationHeader, spClientServiceRequestDurationHeader, sharePointCorrelationHeader, getNamedHeadersFromXhr, getRequestDurationFromXhr, getRequestDurationFromHeaders */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "spRequestDurationHeader", function() { return spRequestDurationHeader; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "spClientServiceRequestDurationHeader", function() { return spClientServiceRequestDurationHeader; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "sharePointCorrelationHeader", function() { return sharePointCorrelationHeader; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getNamedHeadersFromXhr", function() { return getNamedHeadersFromXhr; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getRequestDurationFromXhr", function() { return getRequestDurationFromXhr; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getRequestDurationFromHeaders", function() { return getRequestDurationFromHeaders; });
var spRequestDurationHeader = "sprequestduration";
var spClientServiceRequestDurationHeader = "spclientservicerequestduration";
var sharePointCorrelationHeader = "sprequestguid";
function getNamedHeadersFromXhr(xhr, headers) {
    var matchedHeaders = {};
    if (xhr.getAllResponseHeaders) {
        var responseHeaders_1 = xhr.getAllResponseHeaders();
        headers.forEach(function (header) {
            if (xhr.getResponseHeader && responseHeaders_1.indexOf(header) !== -1) {
                matchedHeaders[header] = xhr.getResponseHeader(header) || "";
            }
        });
    }
    return matchedHeaders;
}
function getRequestDurationFromXhr(xhr) {
    var headers = getNamedHeadersFromXhr(xhr, [
        spRequestDurationHeader,
        spClientServiceRequestDurationHeader
    ]);
    return (headers[spRequestDurationHeader] ||
        headers[spClientServiceRequestDurationHeader] ||
        undefined);
}
function getRequestDurationFromHeaders(headers) {
    return (headers[spRequestDurationHeader] ||
        headers[spClientServiceRequestDurationHeader] ||
        "");
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/promiseCache.js":
/*!************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/promiseCache.js ***!
  \************************************************************************************************************************************************************************************/
/*! exports provided: getPromise, getOrCreateCache, getCache, setCache, getPromotedStorageCacheItems, savePromise, setCacheItem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getPromise", function() { return getPromise; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getOrCreateCache", function() { return getOrCreateCache; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getCache", function() { return getCache; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setCache", function() { return setCache; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getPromotedStorageCacheItems", function() { return getPromotedStorageCacheItems; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "savePromise", function() { return savePromise; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setCacheItem", function() { return setCacheItem; });
/* harmony import */ var _serializeKey__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./serializeKey */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/serializeKey.js");
/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./state */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/state.js");
/* harmony import */ var _storageCache__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./storageCache */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/storageCache.js");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};



/**
 * Gets a Promise from the cache, potentially loading data from storage.
 *
 * @param cacheId A unique identifier for the cache.
 * @param cacheVersion The version of the cache.
 * @param cacheItemKey A unique identifier for the cache item.
 */
function getPromise(cacheId, cacheVersion, puid, cacheItemKey) {
    if (cacheItemKey === void 0) { cacheItemKey = {}; }
    var serializedKey = Object(_serializeKey__WEBPACK_IMPORTED_MODULE_0__["default"])(cacheItemKey);
    var item = getOrCreateCache(cacheId, cacheVersion, puid).cacheItems[serializedKey];
    if (item) {
        if (Date.now() < item.expiryTime) {
            var cacheItemResolved_1 = item.cacheItemResolved;
            return item.value.then(function (v) { return (__assign({}, v, { cacheItemType: item.cacheItemType, cacheItemResolved: cacheItemResolved_1 })); });
        }
        else {
            removePromise(cacheId, serializedKey);
        }
    }
    return null;
}
var getOrCreateCache = function getOrCreateCache(cacheId, cacheVersion, puid) {
    Object(_storageCache__WEBPACK_IMPORTED_MODULE_2__["assertPuid"])(puid);
    var cache = getCache(cacheId);
    if (cache && cache.puid !== puid) {
        cache = null;
    }
    return (cache ||
        setCache(cacheId, {
            puid: puid,
            cacheItems: getPromotedStorageCacheItems(cacheId, cacheVersion, puid) || {}
        }));
};
var getCache = function getCache(cacheId) {
    return Object(_state__WEBPACK_IMPORTED_MODULE_1__["cache"])().caches[cacheId];
};
var setCache = function setCache(cacheId, newCache) {
    return (Object(_state__WEBPACK_IMPORTED_MODULE_1__["cache"])().caches[cacheId] = newCache);
};
function getPromotedStorageCacheItems(cacheId, cacheVersion, puid) {
    var storageCache = Object(_storageCache__WEBPACK_IMPORTED_MODULE_2__["getCache"])(cacheId, cacheVersion, puid);
    if (!storageCache) {
        return null;
    }
    var cacheItems = storageCache.cacheItems;
    var emptyCache = {};
    return Object.keys(cacheItems).reduce(function (cache, cacheItemKey) { return ((cache[cacheItemKey] = {
        value: Promise.resolve({
            xhr: {
                responseText: cacheItems[cacheItemKey].value,
                status: cacheItems[cacheItemKey].status || 0
            }
        }),
        expiryTime: cacheItems[cacheItemKey].expiryTime,
        cacheItemType: "storage",
        cacheItemResolved: true
    }),
        cache); }, emptyCache);
}
function removePromise(id, serializedKey) {
    if (!Object(_state__WEBPACK_IMPORTED_MODULE_1__["cache"])().caches[id]) {
        return null;
    }
    return (Object(_state__WEBPACK_IMPORTED_MODULE_1__["cache"])().caches[id].cacheItems[serializedKey] = null);
}
/**
 * Adds a Promise into an in-memory cache. The value produced by the Promise
 * is propagated into storage. The Promise is removed from the cache if it
 * rejects. After the given refresh interval has elapsed, the Promise and
 * storage cache items are invalidated.
 *
 * @param cacheId A unique identifier for the cache type, upon which versioning
 * is enforced.
 * @param cacheVersion The version of the cache type. If a cache access is
 * performed on the id with a different version, the cache entries for that
 * type are invalidated
 * @param cacheItemLifeTime Represents the number of milliseconds since the
 * save was initiated to when the cache entry should be invalidated.
 * @param cacheItemValue The Promise to cache.
 * @param cacheItemKey A unique identifier for the cache item, only one item is
 * cached for a given id + key pair.
 */
function savePromise(_a, puid, cacheItemValue, cacheItemKey) {
    var cacheId = _a.cacheId, cacheVersion = _a.cacheVersion, cacheItemLifetime = _a.cacheItemLifetime;
    if (cacheItemKey === void 0) { cacheItemKey = {}; }
    Object(_storageCache__WEBPACK_IMPORTED_MODULE_2__["assertPuid"])(puid);
    var serializedKey = Object(_serializeKey__WEBPACK_IMPORTED_MODULE_0__["default"])(cacheItemKey);
    var cacheItems = getOrCreateCache(cacheId, cacheVersion, puid).cacheItems;
    var cacheItem = setCacheItem(cacheItems, serializedKey, {
        value: cacheItemValue,
        expiryTime: Date.now() + cacheItemLifetime,
        cacheItemType: "memory",
        cacheItemResolved: false
    });
    return cacheItemValue.then(function (wrappedXhr) { return (setCacheItem(cacheItems, serializedKey, __assign({}, cacheItem, { cacheItemResolved: true })),
        Object(_storageCache__WEBPACK_IMPORTED_MODULE_2__["saveValue"])(cacheId, cacheVersion, puid, serializedKey, wrappedXhr.xhr.responseText, cacheItem.expiryTime, wrappedXhr.xhr.status), __assign({}, wrappedXhr, { cacheItemResolved: false, cacheItemType: null })); }, function (e) {
        removePromise(cacheId, serializedKey); // Don't cache a rejected promise.
        throw e;
    });
}
var setCacheItem = function setCacheItem(cacheItems, serializedKey, cacheItem) {
    return (cacheItems[serializedKey] = cacheItem);
};


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/serializeKey.js":
/*!************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/serializeKey.js ***!
  \************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return serializeKey; });
function serializeKey(key) {
    if (!isObject(key)) {
        throw new Error("Key argument must be an object.");
    }
    var propKeys = Object.keys(key).sort();
    var numPropKeys = propKeys.length;
    var keyParts = [];
    for (var i = 0; i < numPropKeys; i++) {
        var propKey = propKeys[i];
        var val = key[propKey];
        if (val !== undefined && !isObject(val) && !isFunc(val)) {
            keyParts.push(propKey + ":" + val);
        }
    }
    return keyParts.join(",");
}
function isObject(x) {
    return typeof x === "object" && x !== null;
}
function isFunc(func) {
    return typeof func === "function";
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/state.js":
/*!*****************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/state.js ***!
  \*****************************************************************************************************************************************************************************/
/*! exports provided: BUILD_VERSION, init, thr, puid, cache */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BUILD_VERSION", function() { return BUILD_VERSION; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "init", function() { return init; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "thr", function() { return thr; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "puid", function() { return puid; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "cache", function() { return cache; });
var state;
var BUILD_VERSION = "1.20190625.7.4";
/**
 * Initializes the prefetch library with the specified state.
 *
 * @param initialState The initial state of the prefetch library.
 */
function init(initialState) {
    (state && thr("Can not set initial state more than once.")) ||
        (initialState.cache.participants.push(BUILD_VERSION),
            (state = initialState));
}
/**
 * Throws an error with the specified message.
 *
 * @param msg The error message.
 */
function thr(msg) {
    throw new Error(msg);
}
var puid = getter("puid");
var cache = getter("cache");
function getter(prop) {
    return function () {
        return (state && state[prop]) || thr("Trying to get " + prop + " before it is set.");
    };
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/statusOk.js":
/*!********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/statusOk.js ***!
  \********************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return statusOk; });
function statusOk(status) {
    return (status >= 200 && status <= 300) || status === 0;
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/storageCache.js":
/*!************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/storageCache.js ***!
  \************************************************************************************************************************************************************************************/
/*! exports provided: getCache, getStorage, saveValue, assertPuid */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getCache", function() { return getCache; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getStorage", function() { return getStorage; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "saveValue", function() { return saveValue; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "assertPuid", function() { return assertPuid; });
/* harmony import */ var _msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @msfast/search-dispatcher/lib/dispatcher */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-dispatcher/20190625.7.4/node_modules/@msfast/search-dispatcher/lib/dispatcher.js");
/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./state */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/state.js");


var errorName = "StorageCache";
var storageReadErrorEventEmitted = false;
var storageWriteErrorEventEmitted = false;
var invalidPuidErrorEventEmitted = false;
function getCache(cacheId, cacheVersion, puid) {
    assertPuid(puid);
    var cache;
    var storage = getStorage();
    try {
        var item = storage.getItem(cacheId);
        if (!item) {
            return null;
        }
        cache = JSON.parse(item);
    }
    catch (_a) {
        !storageReadErrorEventEmitted &&
            Object(_msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__["getDispatcher"])().dispatch({
                eventType: "ERROR",
                name: errorName,
                detail: "Failed to read from storage."
            });
        storageReadErrorEventEmitted = true;
        return null;
    }
    if (!cache) {
        return null;
    }
    if (cache.cacheVersion !== cacheVersion) {
        storage.removeItem(cacheId);
        return null;
    }
    if (!cache.puid || cache.puid !== puid) {
        storage.removeItem(cacheId);
        invalidPuidErrorEventEmitted = true;
        !invalidPuidErrorEventEmitted &&
            Object(_msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__["getDispatcher"])().dispatch({
                eventType: "ERROR",
                name: errorName,
                detail: "Invalid puid detected."
            });
        return null;
    }
    return cache;
}
var storage;
var getStorage = function getStorage() {
    return (storage ||
        (storage = {
            getItem: function (key) {
                return sessionStorage.getItem(createKey(key));
            },
            removeItem: function (key) {
                return sessionStorage.removeItem(createKey(key));
            },
            setItem: function (key, value) {
                return sessionStorage.setItem(createKey(key), value);
            }
        }));
};
function createKey(postFix) {
    return "mssearchux-cache-" + postFix;
}
function saveValue(cacheId, cacheVersion, puid, serializedKey, value, expiryTime, status) {
    assertPuid(puid);
    var cache = getCache(cacheId, cacheVersion, puid) || {
        cacheCreationTime: Date.now(),
        cacheVersion: cacheVersion,
        puid: puid,
        cacheItems: {}
    };
    cache.cacheItems[serializedKey] = { value: value, expiryTime: expiryTime, status: status };
    try {
        getStorage().setItem(cacheId, JSON.stringify(cache));
    }
    catch (_a) {
        !storageWriteErrorEventEmitted &&
            Object(_msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__["getDispatcher"])().dispatch({
                eventType: "ERROR",
                name: errorName,
                detail: "Failed to write to session storage."
            });
        storageWriteErrorEventEmitted = true;
    }
}
function assertPuid(puid) {
    !puid && Object(_state__WEBPACK_IMPORTED_MODULE_1__["thr"])("Puid not set.");
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/tokenDetail.js":
/*!***********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/tokenDetail.js ***!
  \***********************************************************************************************************************************************************************************/
/*! exports provided: toTokenDetail, isApproachingExpiration, isValid */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "toTokenDetail", function() { return toTokenDetail; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isApproachingExpiration", function() { return isApproachingExpiration; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isValid", function() { return isValid; });
/* harmony import */ var _Base64Url__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base64Url */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/Base64Url.js");

function toTokenDetail(token) {
    var expEpoch = Number.MAX_VALUE;
    var tokenizedJwtToken = token && token.split(".");
    if (tokenizedJwtToken && tokenizedJwtToken.length === 3) {
        var payload = JSON.parse(Object(_Base64Url__WEBPACK_IMPORTED_MODULE_0__["decode"])(tokenizedJwtToken[1]));
        if (payload && payload.exp) {
            expEpoch = payload.exp * 1000;
        }
    }
    return { token: token, expEpoch: expEpoch };
}
function isApproachingExpiration(tokenDetails) {
    if (!isValid(tokenDetails)) {
        return false;
    }
    var TOKEN_LIFETIME_APPROACHING_EXPIRATION_BUFFER = 4 * 60 * 1000; /* 4m */
    return (Date.now() >
        tokenDetails.expEpoch - TOKEN_LIFETIME_APPROACHING_EXPIRATION_BUFFER);
}
function isValid(tokenDetails) {
    var TOKEN_LIFETIME_BUFFER = 2 * 60 * 1000; /* 2m */
    // Deem token invalid if token does not exist,
    // it has expired or if it is very close to expiring
    if (!tokenDetails) {
        return false;
    }
    var isNearlyExpired = tokenDetails.expEpoch - Date.now() < TOKEN_LIFETIME_BUFFER;
    return !isNearlyExpired;
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withBasicMonitor.js":
/*!****************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withBasicMonitor.js ***!
  \****************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return withBasicMonitor; });
/* harmony import */ var _msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @msfast/search-dispatcher/lib/dispatcher */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-dispatcher/20190625.7.4/node_modules/@msfast/search-dispatcher/lib/dispatcher.js");

function withBasicMonitor(_a, promiseFactory) {
    var monitorType = _a.monitorType, monitorName = _a.monitorName, monitorOnce = _a.monitorOnce, successPropExtractor = _a.successPropExtractor, failurePropExtractor = _a.failurePropExtractor;
    var invoked = false;
    return function monitor(options) {
        if (monitorOnce && invoked) {
            return promiseFactory(options);
        }
        invoked = true;
        var timestamp = Math.round(performance.now());
        var dispatcher = Object(_msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__["getDispatcher"])();
        dispatcher.dispatch({
            eventType: "QOSSTART",
            name: monitorType,
            nameDetail: monitorName,
            timestamp: timestamp
        });
        function stopEvent(result, properties) {
            dispatcher.dispatch({
                eventType: "QOSSTOP",
                name: monitorType,
                result: result,
                nameDetail: monitorName,
                startTimestamp: timestamp,
                totalTime: Math.round(performance.now()) - timestamp,
                properties: properties
            });
        }
        var res;
        try {
            res = promiseFactory(options);
        }
        catch (e) {
            stopEvent("FAILURE", { promiseFactoryFailed: true });
            return Promise.reject(e);
        }
        return res.then(function (response) { return (stopEvent("SUCCESS", tryExtract(response, successPropExtractor, {
            successExtractorFailed: true
        })),
            response); }, function (error) { return (stopEvent("FAILURE", tryExtract(error, failurePropExtractor, {
            failureExtractorFailed: true
        })),
            Promise.reject(error)); });
    };
}
var tryExtract = function (res, extractor, defaultRes) {
    try {
        return (extractor || defaultExtractor)(res);
    }
    catch (_a) {
        return defaultRes;
    }
};
var defaultExtractor = function () { return ({}); };


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withCache.js":
/*!*********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withCache.js ***!
  \*********************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return withCache; });
/* harmony import */ var _promiseCache__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./promiseCache */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/promiseCache.js");
/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./state */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/state.js");


function withCache(promiseFactory) {
    return function withCacheOptions(cacheOptions) {
        return function cachedPromise(options) {
            var cacheKey = cacheOptions.cacheKeyExtractor(options) || {};
            var forceRefresh = cacheOptions.forceRefresh && cacheOptions.forceRefresh();
            return ((!forceRefresh &&
                Object(_promiseCache__WEBPACK_IMPORTED_MODULE_0__["getPromise"])(cacheOptions.cacheId, cacheOptions.cacheVersion, Object(_state__WEBPACK_IMPORTED_MODULE_1__["puid"])(), cacheKey)) ||
                Object(_promiseCache__WEBPACK_IMPORTED_MODULE_0__["savePromise"])(cacheOptions, Object(_state__WEBPACK_IMPORTED_MODULE_1__["puid"])(), promiseFactory(options), cacheKey));
        };
    };
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withMonitor.js":
/*!***********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withMonitor.js ***!
  \***********************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return withMonitor; });
/* harmony import */ var _headerUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./headerUtils */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/headerUtils.js");
/* harmony import */ var _withBasicMonitor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./withBasicMonitor */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withBasicMonitor.js");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


var defaultMonitorType = "prefetch_request";
function withMonitor(_a, promiseFactory) {
    var monitorName = _a.monitorName, _b = _a.monitorType, monitorType = _b === void 0 ? defaultMonitorType : _b, additionalSuccessPropsExtractor = _a.additionalSuccessPropsExtractor;
    return Object(_withBasicMonitor__WEBPACK_IMPORTED_MODULE_1__["default"])({
        monitorName: monitorName,
        monitorType: monitorType,
        successPropExtractor: function (_a) {
            var xhr = _a.xhr, tokenAttemptCount = _a.tokenAttemptCount, tokenFetchDuration = _a.tokenFetchDuration, cacheItemResolved = _a.cacheItemResolved, cacheItemType = _a.cacheItemType;
            return __assign({}, getResponseHeaders(xhr), (tokenAttemptCount
                ? {
                    tokenAttemptCount: tokenAttemptCount,
                    tokenFetchDuration: Math.round(tokenFetchDuration)
                }
                : {}), { cacheItemResolved: cacheItemResolved,
                cacheItemType: cacheItemType }, ((additionalSuccessPropsExtractor &&
                additionalSuccessPropsExtractor(xhr)) ||
                {}));
        },
        failurePropExtractor: function (error) {
            return __assign({}, getResponseHeaders(error), { errorCode: error.status });
        }
    }, function (options) {
        return typeof options === "undefined"
            ? Promise.reject("undefined options")
            : promiseFactory(options);
    });
}
function getResponseHeaders(xhr) {
    if (!xhr || !xhr.getAllResponseHeaders) {
        return {};
    }
    var xhrHeaders = Object(_headerUtils__WEBPACK_IMPORTED_MODULE_0__["getNamedHeadersFromXhr"])(xhr, [
        _headerUtils__WEBPACK_IMPORTED_MODULE_0__["spRequestDurationHeader"],
        _headerUtils__WEBPACK_IMPORTED_MODULE_0__["spClientServiceRequestDurationHeader"],
        _headerUtils__WEBPACK_IMPORTED_MODULE_0__["sharePointCorrelationHeader"]
    ]);
    // Map the request duration header back to the existing logged name
    // 'sprequestduration'.
    var headers = {};
    headers[_headerUtils__WEBPACK_IMPORTED_MODULE_0__["sharePointCorrelationHeader"]] =
        xhrHeaders[_headerUtils__WEBPACK_IMPORTED_MODULE_0__["sharePointCorrelationHeader"]];
    headers[_headerUtils__WEBPACK_IMPORTED_MODULE_0__["spRequestDurationHeader"]] =
        xhrHeaders[_headerUtils__WEBPACK_IMPORTED_MODULE_0__["spRequestDurationHeader"]] ||
            xhrHeaders[_headerUtils__WEBPACK_IMPORTED_MODULE_0__["spClientServiceRequestDurationHeader"]] ||
            undefined;
    return headers;
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withPeriodicRefresh.js":
/*!*******************************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withPeriodicRefresh.js ***!
  \*******************************************************************************************************************************************************************************************/
/*! exports provided: withPeriodicRefresh */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "withPeriodicRefresh", function() { return withPeriodicRefresh; });
/* harmony import */ var _withRefresh__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./withRefresh */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withRefresh.js");

var defaultRefreshInterval = 5 * 60 * 1000; // 5 minutes
function withPeriodicRefresh(apiName, tokenProvider, refreshIntervalMs) {
    // initialize to an invalid token
    var lastUserInvocation;
    var periodicRefreshId;
    var invocationCounter = 0;
    var refreshTokenProvider = Object(_withRefresh__WEBPACK_IMPORTED_MODULE_0__["withRefresh"])(apiName, tokenProvider);
    return function (tokenProviderSpec) {
        invocationCounter++;
        // If this is the first time this provider fetches a token, register a
        // periodic job to refresh the token at the specified interval
        if (!periodicRefreshId) {
            periodicRefreshId = window.setInterval(function () {
                invocationCounter++;
                var logProperties = {
                    invokedByPeriodicRefresh: true,
                    invocationCounter: invocationCounter
                };
                refreshTokenProvider({ attempt: 0 }, logProperties);
                // Stop periodic refresh after one day if user have not interacted
                // with search session in that period.
                var oneDayInMs = 24 * 60 * 60 * 1000;
                if (Date.now() - lastUserInvocation > oneDayInMs) {
                    window.clearInterval(periodicRefreshId);
                    periodicRefreshId = undefined;
                }
            }, refreshIntervalMs || defaultRefreshInterval);
        }
        lastUserInvocation = Date.now();
        var logProperties = {
            invokedByPeriodicRefresh: false,
            invocationCounter: invocationCounter
        };
        return refreshTokenProvider(tokenProviderSpec, logProperties);
    };
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withRefresh.js":
/*!***********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withRefresh.js ***!
  \***********************************************************************************************************************************************************************************/
/*! exports provided: withRefresh, startQos */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "withRefresh", function() { return withRefresh; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "startQos", function() { return startQos; });
/* harmony import */ var _msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @msfast/search-dispatcher/lib/dispatcher */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-dispatcher/20190625.7.4/node_modules/@msfast/search-dispatcher/lib/dispatcher.js");
/* harmony import */ var _tokenDetail__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tokenDetail */ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/tokenDetail.js");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


function withRefresh(apiName, tokenProvider) {
    // initialize to an invalid token
    var latestAuthTokenDetails = null;
    var isRefreshActive = false;
    var refreshedTokenPromise;
    var getRefreshedToken = function () {
        if (!isRefreshActive) {
            // if there isn't already an active refresh request, create one
            isRefreshActive = true;
            refreshedTokenPromise = tokenProvider({ attempt: 1 })
                .then(function (token) {
                latestAuthTokenDetails = Object(_tokenDetail__WEBPACK_IMPORTED_MODULE_1__["toTokenDetail"])(token);
                isRefreshActive = false;
                return token;
            })
                .catch(function (error) {
                isRefreshActive = false;
                throw error;
            });
        }
        return refreshedTokenPromise;
    };
    return function (tokenProviderSpec, logProperties) {
        var stopQos = startQos(apiName + "_withRefresh");
        if (!tokenProvider) {
            stopQos("FAILURE", __assign({ cacheItemResolved: false, tokenProviderNull: true }, logProperties));
            return Promise.reject("token provider is null");
        }
        if (!latestAuthTokenDetails ||
            !Object(_tokenDetail__WEBPACK_IMPORTED_MODULE_1__["isValid"])(latestAuthTokenDetails) ||
            tokenProviderSpec.attempt > 0) {
            // if the token we have is invalid, we need to fetch a new one.
            // likewise if this is a second attempt, whatever is cached must not work
            return getRefreshedToken()
                .then(function (token) {
                stopQos("SUCCESS", __assign({ cacheItemResolved: false, expires: latestAuthTokenDetails &&
                        new Date(latestAuthTokenDetails.expEpoch), didRefresh: true }, logProperties));
                return token;
            })
                .catch(function (error) {
                stopQos("FAILURE", __assign({ cacheItemResolved: false, tokenProviderNull: false }, logProperties));
                throw error.reason || error;
            });
        }
        var shouldBackgroundRefreshToken = Object(_tokenDetail__WEBPACK_IMPORTED_MODULE_1__["isApproachingExpiration"])(latestAuthTokenDetails);
        if (shouldBackgroundRefreshToken) {
            // the token will be expiring soon so begin a new background fetch,
            // but we will still return the value we have
            getRefreshedToken();
        }
        stopQos("SUCCESS", __assign({ cacheItemResolved: true, expires: latestAuthTokenDetails && new Date(latestAuthTokenDetails.expEpoch), backgroundRefresh: shouldBackgroundRefreshToken }, logProperties));
        return Promise.resolve(latestAuthTokenDetails.token);
    };
}
/**
 * Dispatches a QOSSTART event, returning a function which will dispatch a
 * corresponding QOSSTOP event.
 */
function startQos(nameDetail) {
    var eventName = "generic_qos";
    var startTime = performance.now();
    var d = Object(_msfast_search_dispatcher_lib_dispatcher__WEBPACK_IMPORTED_MODULE_0__["getDispatcher"])();
    d.dispatch({
        name: eventName,
        nameDetail: nameDetail,
        timestamp: startTime,
        eventType: "QOSSTART"
    });
    return function (result, properties, error) {
        var endTime = performance.now();
        d.dispatch({
            name: eventName,
            nameDetail: nameDetail,
            startTimestamp: startTime,
            totalTime: endTime - startTime,
            eventType: "QOSSTOP",
            result: result,
            properties: { customLogProps: JSON.stringify(properties) },
            error: error
        });
    };
}


/***/ }),

/***/ "../../common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withToken.js":
/*!*********************************************************************************************************************************************************************************!*\
  !*** C:/agent/1/_work/20/s/common/temp/node_modules/.onedrive.pkgs.visualstudio.com/@msfast/search-prefetch/20190625.7.4/node_modules/@msfast/search-prefetch/lib/withToken.js ***!
  \*********************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return withToken; });
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
function withToken(promiseFactory) {
    return function (options) {
        var startTime = performance.now();
        return callWithAttempt(0, startTime, options, promiseFactory).catch(function (xhr) {
            return isAuthFailure(xhr)
                ? callWithAttempt(1, startTime, options, promiseFactory).catch(function (xhr) {
                    return failWithDetails(xhr, 2, performance.now() - startTime);
                })
                : Promise.reject(xhr);
        });
    };
}
function isAuthFailure(xhr) {
    return xhr ? xhr.status === 401 || xhr.status === 0 : false;
}
function callWithAttempt(attempt, startTime, options, promiseFactory) {
    if (!options.token && !options.tokenProvider) {
        return Promise.reject(new Error("Token or token provider must be specified."));
    }
    var tokenFetchDuration = -1;
    return options.token
        ? promiseFactory(__assign({}, options, { token: options.token })).then(function (xhr) { return ({
            tokenAttemptCount: 0,
            tokenFetchDuration: 0,
            xhr: xhr
        }); })
        : options
            .tokenProvider({ attempt: attempt })
            .then(function (token) { return ((tokenFetchDuration = performance.now() - startTime),
            promiseFactory(__assign({}, options, { token: token }))); })
            .then(function (xhr) { return ({
            tokenAttemptCount: attempt + 1,
            tokenFetchDuration: tokenFetchDuration,
            xhr: xhr
        }); });
}
function failWithDetails(xhr, tokenAttemptCount, tokenFetchDuration) {
    if (isAuthFailure(xhr)) {
        var error = xhr;
        error.tokenAttemptCount = tokenAttemptCount;
        error.tokenFetchDuration = tokenFetchDuration;
        throw error;
    }
    throw xhr;
}


/***/ })

}]);
//# sourceMappingURL=0.0_5129aad76c9c9308ad03.js.map